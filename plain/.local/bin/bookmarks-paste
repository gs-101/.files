#!/usr/bin/env -S guix shell coreutils libnotify procps wtype -- sh
# See https://www.youtube.com/watch?v=d_11QaTlf1I

set -eu

# Variables.

bookmark_dir="$HOME/Documents/bookmarks"
bookmark_file="$bookmark_dir/bookmarks.txt"
later_file="$bookmark_dir/later.txt"

# Helpers.

menu() {
  if pidof hyprlauncher >/dev/null 2>&1; then
    hyprlauncher --dmenu
  else
    tv
  fi
}

# Main script.

mkdir -p "$bookmark_dir"

files=$(printf "%s\n%s\n" "$bookmark_file" "$later_file")
file=$(printf "%s" "$files" | menu)

## 'true' ensures the script doesn't exit if grep finds no matches or the
## menu is cancelled.
target=$(grep -v '^#' "$file" | menu | cut -d ' ' -f1 || true)

if [ -n "$target" ]; then
  wtype "$target"
fi
